<% content_for :stylesheet do -%>
  <style type="text/css">
  table.input_table textarea {
    width: 100%;
  }
  </style>
<% end -%>

  <div class="input_value" style="height: 2em;">
    <%= radio_button_tag("editor_mode", "richtext", params[:editor_mode] == "richtext", :id=>"editor_mode_richtext") %>リッチテキスト
    <%= radio_button_tag("editor_mode", "hiki", params[:editor_mode] == "hiki", :id=>"editor_mode_hiki") -%>Wikiテキスト
    <span class="share_file_uploader trigger pointer link">画像やファイルのリンクを挿入</span>
  </div>

  <div id="share_file_uploader"></div>
  <div id="contents_richtext_space" class="richtext" style="display: none;">
    <label for="contents"><%= text_area_tag 'contents_richtext', h(sanitize_style_with_whitelist(params[:contents_richtext])), :cols => 90, :rows => 20 %></label>
  </div>
  <div id="contents_hiki_space" style="display: none;">
    <%= link_to_hiki_help %> <a href="#" id="hiki_preview_link">【プレビューで確認する】</a>
    <label for="contents"><%= text_area_tag 'contents_hiki', h(params[:contents_hiki]), :cols => 90, :rows => 20 %></label>
  </div>

<% content_for :javascript do -%>
<%= skip_javascript_include_tag "fckeditor/fckeditor" %>
<%= skip_jquery_include_tag 'iframe_upload' %>
<script type='text/javascript'>
$j(function(){
    FCKeditor.BasePath = platform_url_root + "/javascripts/skip/fckeditor/";
    new FCKeditor('contents_richtext', '100%', '330', 'Normal').ReplaceTextarea();

    changeEditorMode = function(){
        $j('#contents_hiki_space, #contents_richtext_space, .hiki_support').hide();

        if($j('#editor_mode_richtext:checked').length > 0){
            $j('#contents_richtext_space').show();
            $j('#contents_richtext').focus();
        } else if($j('#editor_mode_hiki:checked').length > 0) {
            $j('#contents_hiki_space, .hiki_support').show();
            $j('#contents_hiki').focus();
        }
    }

    $j('#editor_mode_hiki, #editor_mode_richtext')
    .click(function(){
        changeEditorMode();
    });

    // プレビュー表示用ボタン
    var url = '<%= url_for({ :action => "ado_preview", :id => @board_entry}) -%>';
    $j("#hiki_preview_link")
    .click(function(){
        $j.ajax({
            type: 'POST',
            url: url,
            data: $j('#board_entry_form').serialize(),
            success: function(msg) {
                $j('#preview').html(msg);
                $j('#preview-win')
                .css('width',600)
                .fadeIn();
            }
        });
        return false;
    });

    var config = {
        share_files_url: '<%= share_files_url @board_entry.symbol %>',
        message: {
            title: '画像やファイルのリンクを挿入',
            close: '閉じる',
            share_files: {
              title: '利用できる共有ファイル',
              thumbnail: 'サムネイル',
              display_name: 'ファイル名',
              insert: ''
            },
            insert_link_label: '挿入する',
            upload_share_file: 'ファイルをアップロードする'
        },
        uploader: {
            target: '<%= IframeUploader::UPLOAD_KEY %>',
            src: {
                form: '<%= url_for(:controller => 'share_file', :action => 'new', :owner_symbol => @board_entry.symbol, :ajax_upload => 1, :escape => false) %>',
                target: ''
            },
            callback: null
        }
    };
    $j('div#share_file_uploader').shareFileUploader(config);
});
</script>
<% end -%>
